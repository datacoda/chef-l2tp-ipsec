# This file was generated by Chef for <%= node['fqdn'] %>
# Do NOT modify this file by hand!
# Configuration for Ubuntu 14.04 and above

version 2

config setup
    dumpdir=/var/run/pluto/
    nat_traversal=yes
    virtual_private=<% if !@virtual_private.nil? -%><%= @virtual_private %>,<% end -%>%v4:!<%= @ppp_link_network %>,%v4:!<%= @private_ip %>/32
    protostack=netkey
    force_keepalive=yes
    keep_alive=60

conn L2TP-PSK-noNAT
    authby=secret
    pfs=no
    auto=add
    keyingtries=3

    rekey=no

    ike=aes256-sha1,aes128-sha1,3des-sha1
    phase2alg=aes256-sha1,aes128-sha1,3des-sha1
    # https://lists.openswan.org/pipermail/users/2014-April/022947.html
    # specifies the phase 1 encryption scheme, the hashing algorithm, and the diffie-hellman group. The modp1024 is for Diffie-Hellman 2. Why 'modp' instead of dh? DH2 is a 1028 bit encryption algorithm that modulo's a prime number, e.g. modp1028. See RFC 5114 for details or the wiki page on diffie hellmann, if interested.

    # Apple iOS doesn't send delete notify so we need dead peer detection
    # to detect vanishing clients
    dpddelay=30
    dpdtimeout=120
    dpdaction=clear

    # Set ikelifetime and keylife to same defaults windows has
    ikelifetime=8h
    keylife=1h
    type=transport

    # Replace IP address with your local IP
    left=<%= @public_ip %>

    # For updated Windows 2000/XP clients,
    # to support old clients as well, use leftprotoport=17/%any
    leftprotoport=17/1701
    right=%any
    rightprotoport=17/%any

    #force all to be nat'ed. because of iOS
    #forceencaps=yes

# leave blank line after this

