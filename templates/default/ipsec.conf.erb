# This file was generated by Chef for <%= node[:fqdn] %>
# Do NOT modify this file by hand!

config setup
    nat_traversal=yes
    virtual_private=%v4:<%= @ppp_link_network %>,%v4:<%= @private_ip %>/32
    oe=off
    protostack=netkey

conn L2TP-PSK-NAT
    rightsubnet=vhost:%priv
    also=L2TP-PSK-noNAT

conn L2TP-PSK-noNAT
    authby=secret
    pfs=no
    auto=add
    keyingtries=3
    rekey=no

    # Apple iOS doesn't send delete notify so we need dead peer detection
    # to detect vanishing clients
    dpddelay=30
    dpdtimeout=120
    dpdaction=clear

    # Set ikelifetime and keylife to same defaults windows has
    ikelifetime=8h
    keylife=1h
    type=transport

    # Replace IP address with your local IP
    left=<%= @public_ip %>

    # For updated Windows 2000/XP clients,
    # to support old clients as well, use leftprotoport=17/%any
    leftprotoport=17/1701
    right=%any
    rightprotoport=17/%any

    #force all to be nat'ed. because of iOS
    #forceencaps=yes

# leave blank line after this

